<%
    let posts = site.posts,
        current = (page.current - 1) * config.index_generator.per_page;
    posts.data.sort((a, b) => {
        let x = a.pinned ?? 0,
            y = b.pinned ?? 0;
        return x === y ? b.date - a.date : y - x;
    });
    posts = posts.slice(current, config.index_generator.per_page + current);
%>
<% posts.forEach((post) => { %>
<%
    const txStyle = getTxStyle(post);
    const txVars = txStyle
        ? `--tx-post-bg:${txStyle.post.bg};--tx-post-text:${txStyle.post.text};--tx-cat-bg:${txStyle.categoryChip.bg};--tx-cat-text:${txStyle.categoryChip.text}`
        : '';
    const fxClasses = [];
    if (txStyle && txStyle.effects.outline.enable) fxClasses.push('fx-outline');
    if (txStyle && txStyle.effects.spark.enable) fxClasses.push('fx-spark');
    const fxVars = [];
    if (txStyle && txStyle.effects.outline.enable) {
        fxVars.push(`--fx-outline-color:${txStyle.effects.outline.color}`);
        fxVars.push(`--fx-outline-width:${txStyle.effects.outline.width}`);
    }
    if (txStyle && txStyle.effects.spark.enable) {
        fxVars.push(`--fx-spark-color:${txStyle.effects.spark.color}`);
        fxVars.push(`--fx-spark-blur:${txStyle.effects.spark.blur}`);
        fxVars.push(`--fx-spark-opacity:${txStyle.effects.spark.opacity}`);
        fxVars.push(`--fx-spark-duration:${txStyle.effects.spark.duration}`);
    }
    const allVars = [txVars, ...fxVars].filter(Boolean).join(';');
    const catName = txStyle ? txStyle.category : null;
%>
<div class="post<%= fxClasses.length ? ' ' + fxClasses.join(' ') : '' %>" <% if (txStyle) { %>data-category="<%- catName %>" style="<%- allVars %>"<% } %>>
    <a href="<%- url_for(post.path) %>">
        <h2 class="post-title"><%= post.title %></h2>
    </a>
    <div class="category-and-date">
        <% if (post.categories.data.length !== 0) { %>
        <%
            const catStyle = getTxCategoryStyle(post.categories.data[0].name);
        %>
        <span class="category">
            <a href="<%- url_for(post.categories.data[0].path) %>"<% if (catStyle) { %> style="color:<%- catStyle.text %>"<% } %>>
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                <%= post.categories.data[0].name %>
            </a>
        </span>
        <% } %>
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            <%- date(post.date, "YYYY/M/D") %>
        </span>
        <% if (theme.crypto.enable && typeof post.secret !== "undefined") { %>
        <span class="special">
            <i class="fa-solid fa-lock fa-fw"></i>
        </span>
        <% } %>
        <% if (typeof post.pinned !== "undefined") { %>
        <span class="special">
            <i class="fa-solid fa-grip-vertical fa-fw"></i>
        </span>
        <% } %>
    </div>
    <div class="description">
        <div class="content" v-pre>
            <% if (typeof post.description !== "undefined") { %>
            <%- markdown(post.description) %>
            <% } else if (post.excerpt) { %>
            <%- post.excerpt %>
            <% } else { %>
            <%- post.content %>
            <% } %>
        </div>
    </div>
    <div class="post-tags">
        <% if (post.tags.data.length !== 0) { %>
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        <% } %>
        <% post.tags.data.forEach((tag) => { %>
        <%
            const tagStyle = getTxTagStyle(tag.name, catName);
        %>
        <span class="tag">
             <a href="<%- url_for(tag.path) %>"<% if (tagStyle) { %> style="color:<%- tagStyle.text %>"<% } %>><%= tag.name %></a>
        </span>
        <% }); %>
    </div>
    <a href="<%- url_for(post.path) %>" class="go-post"<% if (txStyle) { %> style="background:<%- txStyle.categoryChip.bg %>;color:<%- txStyle.categoryChip.text %>"<% } %>><%- (theme.i18n && theme.i18n.read_more) || 'Read more' %></a>
</div>
<% }); %>
